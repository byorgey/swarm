version: 1
name: Test issue 397 (wrong device reported missing)
description: |
  A scenario designed to trigger issue 397, where in certain
  situations involving a capability with no candidate devices,
  an incorrect error message was generated reporting some other
  device to be missing.
  https://github.com/swarm-game/swarm/issues/397
objectives:
  - condition: |
      as base { ishere "rock" }
    goal:
    - |
      This is a dummy condition that just ensures the base has
      finished trying to run the problematic `build` command.  The
      scenario *should* generate an error message; what really care
      about is whether the generated error message is correct, which
      is checked in test/integration/Main.hs .
solution: |
  build {require 1 "rock"; wait 4; place "rock"};
  build {move; turn right; loc <- whereami}
robots:
  - name: base
    dir: [0,1]
    devices:
      - 3D printer
      - logger
    inventory:
      - [1, clock]
      - [1, grabber]
      - [1, treads]
      - [2, solar panel]
      - [1, rock]
world:
  default: [blank]
  palette:
    'Ω': [grass, null, base]
    '.': [grass]
  upperleft: [0,1]
  map: |
    .
    Ω
