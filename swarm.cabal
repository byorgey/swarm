cabal-version:      2.4
name:               swarm
version:            0.3.0.1
synopsis:           2D resource gathering game with programmable robots

description:        Swarm is a 2D programming and resource gathering
                    game. Program your robots to explore the world and
                    collect resources, which in turn allows you to
                    build upgraded robots that can run more
                    interesting and complex programs. See the README
                    for more information and instructions on how to
                    play or contribute!

license:            BSD-3-Clause
license-file:       LICENSE
author:             Brent Yorgey
maintainer:         byorgey@gmail.com
bug-reports:        https://github.com/swarm-game/swarm/issues
copyright:          Brent Yorgey 2021
category:           Game
tested-with:        GHC ==8.10.7 || ==9.0.2 || ==9.2.4 || ==9.4.2
extra-source-files: CHANGELOG.md
                    example/*.sw
                    editors/emacs/*.el
                    editors/vscode/syntaxes/*.json
data-dir:           data/
data-files:         *.yaml, scenarios/**/*.yaml, scenarios/**/*.txt, scenarios/**/*.sw, *.txt, test/language-snippets/**/*.sw

source-repository head
    type:     git
    location: git://github.com/swarm-game/swarm.git

flag ci
  description: Make warnings error
  default:     False
  manual:      True

common common
  if flag(ci)
    ghc-options:    -Werror
  ghc-options:      -Wall
                    -Wcompat
                    -Widentities
                    -Wincomplete-uni-patterns
                    -Wincomplete-record-updates
                    -Wno-star-is-type
                    -Wunused-packages
  if impl(ghc >= 8.4)
    ghc-options:    -Wpartial-fields
  default-language: Haskell2010

common stan-config
    ghc-options:      -fwrite-ide-info
                      -hiedir=.hie

-- Harmless extensions from GHC2021
common ghc2021-extensions
    ghc-options:  -Wprepositive-qualified-module
    default-extensions:
      BangPatterns
      DeriveAnyClass
      DeriveDataTypeable
      DeriveFunctor
      DeriveGeneric
      DeriveTraversable
      ExplicitForAll
      FlexibleContexts
      FlexibleInstances
      GADTSyntax
      MultiParamTypeClasses
      NumericUnderscores
      RankNTypes
      ScopedTypeVariables
      StandaloneDeriving
      TupleSections
      TypeApplications
      TypeOperators
      -- Note we warn on prequalified
      ImportQualifiedPost
      -- Not GHC2021, but until we get \cases we use \case a lot
      LambdaCase


library boolexpr
    import:           stan-config, common, ghc2021-extensions
    exposed-modules:  Data.BoolExpr
                      Data.BoolExpr.Simplify
    build-depends:    base                          >= 4.14 && < 4.18,
                      aeson                         >= 2 && < 2.2,
                      containers                    >= 0.6.2 && < 0.7,
    hs-source-dirs:   src/boolexpr
    default-language: Haskell2010
    default-extensions:
      -- Avoid unexpected unevaluated thunk buildup
      -- See discussion in #415
      StrictData 

library swarm-util
    import:           stan-config, common, ghc2021-extensions
    exposed-modules:  Swarm.Util
                      Swarm.Util.Yaml
    other-modules:    Paths_swarm
    autogen-modules:  Paths_swarm
    build-depends:    base                          >= 4.14 && < 4.18,
                      aeson                         >= 2 && < 2.2,
                      clock                         >= 0.8.2 && < 0.9,
                      containers                    >= 0.6.2 && < 0.7,
                      directory                     >= 1.3 && < 1.4,
                      either                        >= 5.0 && < 5.1,
                      filepath                      >= 1.4 && < 1.5,
                      fused-effects                 >= 1.1.1.1 && < 1.2,
                      lens                          >= 4.19 && < 5.3,
                      minimorph                     >= 0.3 && < 0.4,
                      mtl                           >= 2.2.2 && < 2.3,
                      template-haskell              >= 2.16 && < 2.20,
                      text                          >= 1.2.4 && < 2.1,
                      vector                        >= 0.12 && < 0.14,
                      witch                         >= 1.1.1.0 && < 1.2,
                      yaml                          >= 0.11 && < 0.12,
    hs-source-dirs:   src/swarm-util
    default-language: Haskell2010
    default-extensions:
      -- Avoid unexpected unevaluated thunk buildup
      -- See discussion in #415
      StrictData


library swarm-language
    import:           stan-config, common, ghc2021-extensions
    exposed-modules:  Swarm.Language.Context
                      Swarm.Language.Capability
                      Swarm.Language.Elaborate
                      Swarm.Language.Module
                      Swarm.Language.Parse
                      Swarm.Language.Parse.QQ
                      Swarm.Language.Pipeline
                      Swarm.Language.Pipeline.QQ
                      Swarm.Language.Pretty
                      Swarm.Language.Requirement
                      Swarm.Language.Syntax
                      Swarm.Language.Typecheck
                      Swarm.Language.Typed
                      Swarm.Language.Types
                      Swarm.Language.Value
    build-depends:    base                          >= 4.14 && < 4.18,
                      aeson                         >= 2 && < 2.2,
                      containers                    >= 0.6.2 && < 0.7,
                      hashable                      >= 1.3.4 && < 1.5,
                      lens                          >= 4.19 && < 5.3,
                      megaparsec                    >= 9.0 && < 9.4,
                      mtl                           >= 2.2.2 && < 2.3,
                      parser-combinators            >= 1.2 && < 1.4,
                      prettyprinter                 >= 1.7.0 && < 1.8,
                      syb                           >= 0.7 && < 0.8,
                      template-haskell              >= 2.16 && < 2.20,
                      text                          >= 1.2.4 && < 2.1,
                      unification-fd                >= 0.11  && < 0.12,
                      witch                         >= 1.1.1.0 && < 1.2,
                      yaml                          >= 0.11 && < 0.12,
                      swarm-util,
    hs-source-dirs:   src/swarm-language
    default-language: Haskell2010
    default-extensions:
      -- Avoid unexpected unevaluated thunk buildup
      -- See discussion in #415
      StrictData

library swarm-language-server
    import:           stan-config, common, ghc2021-extensions
    exposed-modules:  Swarm.Language.LSP
                      Swarm.Language.LSP.Hover
                      Swarm.Language.LSP.VarUsage
    build-depends:    
                      lens                          >= 4.19 && < 5.3,
                      lsp                           >= 1.6 && < 1.7,
                      text                          >= 1.2.4 && < 2.1,
                      text-rope                     >= 0.2 && < 0.3,
                      witch                         >= 1.1.1.0 && < 1.2,
                      -- Imports shared with the library don't need bounds
                      swarm-util,
                      swarm-language,
                      base,
                      containers,
    hs-source-dirs:   src/swarm-language-server
    default-language: Haskell2010

library swarm-game
    import:           stan-config, common, ghc2021-extensions
    exposed-modules:  
                      Swarm.Game.Achievement.Attainment
                      Swarm.Game.Achievement.Definitions
                      Swarm.Game.Achievement.Description
                      Swarm.Game.Achievement.Persistence
                      Swarm.Game.CESK
                      Swarm.Game.Display
                      Swarm.Game.Entity
                      Swarm.Game.Exception
                      Swarm.Game.Log
                      Swarm.Game.Location
                      Swarm.Game.Recipe
                      Swarm.Game.Robot
                      Swarm.Game.Scenario
                      Swarm.Game.Scenario.Cell
                      Swarm.Game.Scenario.Objective.Logic
                      Swarm.Game.Scenario.Objective.Graph
                      Swarm.Game.Scenario.Objective.Validation
                      Swarm.Game.Scenario.Objective.WinCheck
                      Swarm.Game.Scenario.Objective
                      Swarm.Game.Scenario.RobotLookup
                      Swarm.Game.Scenario.Style
                      Swarm.Game.Scenario.WorldDescription
                      Swarm.Game.ScenarioInfo
                      Swarm.Game.State
                      Swarm.Game.Step
                      Swarm.Game.Terrain
                      Swarm.Game.World
                      Swarm.Game.WorldGen
                      Swarm.Game.Util.Failure
    other-modules:    Paths_swarm
    autogen-modules:  Paths_swarm
    build-depends:    base                          >= 4.14 && < 4.18,
                      aeson                         >= 2 && < 2.2,
                      array                         >= 0.5.4 && < 0.6,
                      bytestring                    >= 0.10 && < 0.12,
                      clock                         >= 0.8.2 && < 0.9,
                      containers                    >= 0.6.2 && < 0.7,
                      directory                     >= 1.3 && < 1.4,
                      either                        >= 5.0 && < 5.1,
                      extra                         >= 1.7 && < 1.8,
                      filepath                      >= 1.4 && < 1.5,
                      fused-effects                 >= 1.1.1.1 && < 1.2,
                      fused-effects-lens            >= 1.2.0.1 && < 1.3,
                      hashable                      >= 1.3.4 && < 1.5,
                      hsnoise                       >= 0.0.3 && < 0.1,
                      lens                          >= 4.19 && < 5.3,
                      linear                        >= 1.21.6 && < 1.23,
                      mtl                           >= 2.2.2 && < 2.3,
                      murmur3                       >= 1.0.4 && < 1.1,
                      prettyprinter                 >= 1.7.0 && < 1.8,
                      random                        >= 1.2.0 && < 1.3,
                      SHA                           >= 1.6.4 && < 1.6.5,
                      simple-enumeration            >= 0.2 && < 0.3,
                      tagged                        >= 0.8 && < 0.9,
                      text                          >= 1.2.4 && < 2.1,
                      time                          >= 1.9 && < 1.14,
                      vector                        >= 0.12 && < 0.14,
                      witch                         >= 1.1.1.0 && < 1.2,
                      yaml                          >= 0.11 && < 0.12,
                      boolexpr,
                      swarm-util,
                      swarm-language,
    hs-source-dirs:   src/swarm-game
    default-language: Haskell2010
    default-extensions:
      -- Avoid unexpected unevaluated thunk buildup
      -- See discussion in #415
      StrictData

library swarm-version
    import:           stan-config, common, ghc2021-extensions
    exposed-modules:  
                      Swarm.Version
    other-modules:    Paths_swarm
    autogen-modules:  Paths_swarm

    build-depends:    base                          >= 4.14 && < 4.18,
                      aeson                         >= 2 && < 2.2,
                      bytestring                    >= 0.10 && < 0.12,
                      githash                       >= 0.1.6 && < 0.2,
                      http-client                   >= 0.7 && < 0.8,
                      http-client-tls               >= 0.3 && < 0.4,
                      http-types                    >= 0.12 && < 0.13,
                      yaml                          >= 0.11 && < 0.12,
    hs-source-dirs:   src/swarm-version
    default-language: Haskell2010
    default-extensions:
      -- Avoid unexpected unevaluated thunk buildup
      -- See discussion in #415
      StrictData

library swarm-tui
    import:           stan-config, common, ghc2021-extensions
    exposed-modules:  Swarm.TUI.Attr
                      Swarm.TUI.Border
                      Swarm.TUI.Controller
                      Swarm.TUI.Controller.Util
                      Swarm.TUI.View.CustomStyling
                      Swarm.TUI.Inventory.Sorting
                      Swarm.TUI.List
                      Swarm.TUI.Model
                      Swarm.TUI.Model.Goal
                      Swarm.TUI.Model.Menu
                      Swarm.TUI.Model.Name
                      Swarm.TUI.Model.Repl
                      Swarm.TUI.Model.StateUpdate
                      Swarm.TUI.Model.UI
                      Swarm.TUI.Panel
                      Swarm.TUI.View
                      Swarm.TUI.View.Achievement
                      Swarm.TUI.View.CellDisplay
                      Swarm.TUI.View.Objective
                      Swarm.TUI.View.Util
    other-modules:    Paths_swarm
    autogen-modules:  Paths_swarm

    build-depends:    base                          >= 4.14 && < 4.18,
                      aeson                         >= 2 && < 2.2,
                      array                         >= 0.5.4 && < 0.6,
                      brick                         >= 1.5 && < 1.7,
                      clock                         >= 0.8.2 && < 0.9,
                      containers                    >= 0.6.2 && < 0.7,
                      extra                         >= 1.7 && < 1.8,
                      filepath                      >= 1.4 && < 1.5,
                      fused-effects                 >= 1.1.1.1 && < 1.2,
                      githash                       >= 0.1.6 && < 0.2,
                      lens                          >= 4.19 && < 5.3,
                      linear                        >= 1.21.6 && < 1.23,
                      mtl                           >= 2.2.2 && < 2.3,
                      natural-sort                  >= 0.1.2 && < 0.2,
                      split                         >= 0.2.3 && < 0.3,
                      text                          >= 1.2.4 && < 2.1,
                      text-zipper                   >= 0.10 && < 0.13,
                      time                          >= 1.9 && < 1.14,
                      vector                        >= 0.12 && < 0.14,
                      vty                           >= 5.33 && < 5.38,
                      witch                         >= 1.1.1.0 && < 1.2,
                      word-wrap                     >= 0.5 && < 0.6,
                      warp                          >= 3.2 && < 3.4,
                      swarm-util,
                      swarm-language,
                      swarm-game,
                      swarm-version,
    hs-source-dirs:   src/swarm-user-interface
    default-language: Haskell2010
    default-extensions:
      -- Avoid unexpected unevaluated thunk buildup
      -- See discussion in #415
      StrictData


library
    import:           stan-config, common, ghc2021-extensions
    exposed-modules:  Swarm.App
                      Swarm.DocGen
                      Swarm.Web
    other-modules:    Paths_swarm
    autogen-modules:  Paths_swarm

    build-depends:    base                          >= 4.14 && < 4.18,
                      brick                         >= 1.5 && < 1.7,
                      containers                    >= 0.6.2 && < 0.7,
                      dotgen                        >= 0.4 && < 0.5,
                      lens                          >= 4.19 && < 5.3,
                      mtl                           >= 2.2.2 && < 2.3,
                      servant-server                >= 0.19 && < 0.20,
                      text                          >= 1.2.4 && < 2.1,
                      vty                           >= 5.33 && < 5.38,
                      wai                           >= 3.2 && < 3.3,
                      warp                          >= 3.2 && < 3.4,
                      witch                         >= 1.1.1.0 && < 1.2,
                      yaml                          >= 0.11 && < 0.12,
                      swarm-util,
                      swarm-language,
                      swarm-game,
                      swarm-version,
                      swarm-tui,
    hs-source-dirs:   src/swarm-app
    default-language: Haskell2010
    default-extensions:
      -- Avoid unexpected unevaluated thunk buildup
      -- See discussion in #415
      StrictData

executable swarm
    import:           stan-config, common
    main-is:          Main.hs
    build-depends:    optparse-applicative          >= 0.16 && < 0.18,
                      githash                       >= 0.1.6 && < 0.2,
                      -- Imports shared with the library don't need bounds
                      base,
                      text,
                      swarm,
                      swarm-language,
                      swarm-language-server,
                      swarm-version,
                      swarm-tui,
    hs-source-dirs:   src/swarm-exe
    default-language: Haskell2010
    ghc-options:      -threaded
    default-extensions: ImportQualifiedPost

test-suite swarm-unit
    import:           stan-config, common, ghc2021-extensions
    main-is:          Main.hs
    type:             exitcode-stdio-1.0
    other-modules:    TestEval
                      TestInventory
                      TestModel
                      TestNotification
                      TestLanguagePipeline
                      TestPretty
                      TestBoolExpr
                      TestLSP
                      TestUtil

    build-depends:    tasty                         >= 0.10 && < 1.5,
                      tasty-hunit                   >= 0.10 && < 0.11,
                      tasty-quickcheck              >= 0.10 && < 0.11,
                      QuickCheck                    >= 2.14 && < 2.15,
                      -- Imports shared with the library don't need bounds
                      aeson,
                      base,
                      boolexpr,
                      containers,
                      filepath,
                      hashable,
                      lens,
                      mtl,
                      swarm-util,
                      swarm-language,
                      swarm-language-server,
                      swarm-game,
                      swarm-tui,
                      text,
                      witch
    hs-source-dirs:   test/unit
    default-language: Haskell2010
    ghc-options:      -threaded

test-suite swarm-integration
    import:           stan-config, common, ghc2021-extensions
    main-is:          Main.hs
    type:             exitcode-stdio-1.0

    build-depends:    tasty                         >= 0.10 && < 1.5,
                      tasty-hunit                   >= 0.10 && < 0.11,
                      -- tasty-expected-failure        >= 0.12 && < 0.13,
                      -- Imports shared with the library don't need bounds
                      base,
                      containers,
                      directory,
                      filepath,
                      lens,
                      mtl,
                      swarm,
                      swarm-util,
                      swarm-language,
                      swarm-game,
                      text,
                      transformers,
                      witch,
                      yaml
    hs-source-dirs:   test/integration
    default-language: Haskell2010
    ghc-options:      -threaded

benchmark benchmark
  import:         stan-config, common, ghc2021-extensions
  main-is:        Benchmark.hs
  hs-source-dirs: test/bench
  type:           exitcode-stdio-1.0
  build-depends:  criterion                         >= 1.6.0.0 && < 1.7,
                  -- Import shared with the library don't need bounds
                  base,
                  lens,
                  mtl,
                  swarm-language,
                  swarm-game,
  default-language: Haskell2010
  ghc-options:      -threaded
